<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Minecraft 2D E-Ink Simple</title>
<style type="text/css">
  body { margin:0; padding:0; background:#fff; color:#000; font-family:Arial,Helvetica,sans-serif; }
  #wrap { position:relative; width:100%; height:100%; overflow:hidden; }
  #gameCanvas { display:block; margin:20px auto; background:#fff; border:1px solid #000; }
  #hud { text-align:center; font-size:18px; margin:8px; }
  #hotbar { text-align:center; margin:10px; }
  .slot { display:inline-block; width:40px; height:40px; border:1px solid #000;
          margin:2px; line-height:40px; background:#eee; }
  .sel { background:#000; color:#fff; }
  #controls { text-align:center; margin-top:10px; }
  .btn { display:inline-block; width:80px; height:40px; margin:5px; 
         font-size:16px; border:1px solid #000; background:#fff; }
  #msg { text-align:center; margin:6px; font-size:14px; }
</style>
</head>
<body>
<div id="wrap">
  <div id="hud">HP: <span id="hp">10</span></div>
  <canvas id="gameCanvas" width="600" height="240"></canvas>
  <div id="hotbar"></div>
  <div id="controls">
    <div>
      <button class="btn" id="btnUp">↑</button>
    </div>
    <div>
      <button class="btn" id="btnLeft">←</button>
      <button class="btn" id="btnDown">↓</button>
      <button class="btn" id="btnRight">→</button>
    </div>
    <button class="btn" id="btnBreak">⛏</button>
    <button class="btn" id="btnPlace">⬜</button>
    <button class="btn" id="btnAtk">⚔</button>
  </div>
  <div id="msg"></div>
</div>

<script type="text/javascript">
var TILE=20, W=30, H=10;
var canvas=document.getElementById("gameCanvas"), ctx=canvas.getContext("2d");
var world=new Array(W*H);
var BLOCK={AIR:0,SOL:1};
var COLOR={0:"#fff",1:"#000"};
var player={x:5,y:H-2,hp:10,sel:null,inv:{1:5}};
var mobs=[];
function idx(x,y){return y*W+x;}

function genWorld(){
  for(var y=0;y<H;y++){
    for(var x=0;x<W;x++){
      if(y==H-1) world[idx(x,y)]=BLOCK.SOL;
      else world[idx(x,y)]=BLOCK.AIR;
    }
  }
  mobs=[{x:15,y:H-2,hp:3}];
}
genWorld();

function draw(){
  ctx.fillStyle="#fff";ctx.fillRect(0,0,canvas.width,canvas.height);
  for(var y=0;y<H;y++){for(var x=0;x<W;x++){
    var id=world[idx(x,y)];
    if(id!=BLOCK.AIR){ctx.fillStyle=COLOR[id];ctx.fillRect(x*TILE,y*TILE,TILE,TILE);}
  }}
  for(var i=0;i<mobs.length;i++){
    var m=mobs[i];ctx.fillStyle="#000";ctx.fillRect(m.x*TILE,m.y*TILE,TILE,TILE);
  }
  ctx.fillStyle="#000";ctx.fillRect(player.x*TILE,player.y*TILE,TILE,TILE);
  document.getElementById("hp").innerHTML=player.hp;
  updateHotbar();
}

function updateHotbar(){
  var hb=document.getElementById("hotbar");hb.innerHTML="";
  var s=document.createElement("div");s.className="slot"+(player.sel===BLOCK.SOL?" sel":"");
  s.innerHTML=player.inv[1]||0; s.onclick=function(){player.sel=BLOCK.SOL;updateHotbar();};
  hb.appendChild(s);
}

function move(dx,dy){
  var nx=player.x+dx,ny=player.y+dy;
  if(nx>=0&&ny>=0&&nx<W&&ny<H&&world[idx(nx,ny)]==BLOCK.AIR){
    player.x=nx;player.y=ny;
  }
  draw();
}

function mine(){
  var tx=player.x+1,ty=player.y;
  if(tx<W&&world[idx(tx,ty)]==BLOCK.SOL){world[idx(tx,ty)]=BLOCK.AIR;player.inv[1]=(player.inv[1]||0)+1;}
  draw();
}

function place(){
  if(player.sel!==null&&player.inv[1]>0){
    var tx=player.x+1,ty=player.y;
    if(tx<W&&world[idx(tx,ty)]==BLOCK.AIR){
      world[idx(tx,ty)]=player.sel;player.inv[1]--;
    }
  }
  draw();
}

function attack(){
  for(var i=mobs.length-1;i>=0;i--){
    var m=mobs[i];
    if(Math.abs(m.x-(player.x+1))<=0&&m.y==player.y){
      m.hp--;if(m.hp<=0){mobs.splice(i,1);}
    }
  }
  draw();
}

function mobsTick(){
  for(var i=0;i<mobs.length;i++){
    var m=mobs[i];
    if(m.x>player.x) m.x--; else if(m.x<player.x) m.x++;
    if(m.x==player.x&&m.y==player.y) player.hp--;
  }
  if(player.hp<=0){showMsg("Game Over");}
  draw();
}

function showMsg(t){document.getElementById("msg").innerHTML=t;}

/* controls */
document.getElementById("btnUp").onclick=function(){move(0,-1);};
document.getElementById("btnDown").onclick=function(){move(0,1);};
document.getElementById("btnLeft").onclick=function(){move(-1,0);};
document.getElementById("btnRight").onclick=function(){move(1,0);};
document.getElementById("btnBreak").onclick=mine;
document.getElementById("btnPlace").onclick=place;
document.getElementById("btnAtk").onclick=attack;

setInterval(mobsTick,1000); /* 1 tick/sec for e-ink */
draw();
</script>
</body>
</html>
